{"version":3,"sources":["webpack:///./node_modules/@firebase/functions/dist/index.cjs.js","webpack:///./node_modules/@firebase/installations/dist/index.esm.js","webpack:///./node_modules/@firebase/logger/dist/index.esm.js"],"names":["_interopDefault","ex","Object","defineProperty","exports","value","firebase","__webpack_require__","tslib_1","errorCodeMap","OK","CANCELLED","UNKNOWN","INVALID_ARGUMENT","DEADLINE_EXCEEDED","NOT_FOUND","ALREADY_EXISTS","PERMISSION_DENIED","UNAUTHENTICATED","RESOURCE_EXHAUSTED","FAILED_PRECONDITION","ABORTED","OUT_OF_RANGE","UNIMPLEMENTED","INTERNAL","UNAVAILABLE","DATA_LOSS","HttpsErrorImpl","_super","code","message","details","_this","call","this","setPrototypeOf","prototype","__extends","Error","codeForHTTPStatus","status","_errorForResponse","bodyJSON","serializer","description","undefined","errorJSON","error","status_1","decode","e","ContextProvider","app","getAuthToken","__awaiter","token","__generator","_a","label","trys","push","getToken","sent","accessToken","getInstanceIdToken","messaging","getContext","authToken","instanceIdToken","LONG_TYPE","UNSIGNED_LONG_TYPE","mapValues","o","f","result","key","hasOwnProperty","Serializer","encode","data","Number","valueOf","isFinite","toString","Array","isArray","map","x","json","parseFloat","isNaN","failAfter","millis","Promise","_","reject","setTimeout","Service","app_","region_","emulatorOrigin","delete","deleteService","contextProvider","cancelAllRequests","resolve","get","enumerable","configurable","_url","name","projectId","options","region","origin_1","useFunctionsEmulator","origin","httpsCallable","callable","postJSON","url","body","headers","response","append","fetch","method","JSON","stringify","context","timeout","responseData","decodedData","Headers","race","FUNCTIONS_TYPE","factory","unused","registerFunctions","instance","namespaceExports","Functions","registerService","r","__webpack_exports__","d","registerInstallations","_firebase_app__WEBPACK_IMPORTED_MODULE_0__","_firebase_app__WEBPACK_IMPORTED_MODULE_0___default","n","_firebase_util__WEBPACK_IMPORTED_MODULE_1__","idb__WEBPACK_IMPORTED_MODULE_2__","__assign","assign","t","s","i","arguments","length","p","apply","thisArg","_arguments","P","generator","fulfilled","step","next","rejected","done","then","y","g","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","__read","m","ar","__spread","concat","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","SERVICE","SERVICE_NAME","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","isServerError","includes","extractAppConfig","create","appName","apiKey","appId","getInstallationsEndpoint","extractAuthTokenInfoFromResponse","requestStatus","expiresIn","getExpiresInFromResponseExpiresIn","creationTime","Date","now","getErrorFromResponse","requestName","responseJson","errorData","serverCode","serverMessage","serverStatus","getHeaders","Content-Type","Accept","x-goog-api-key","getHeadersWithAuth","appConfig","refreshToken","getAuthorizationHeader","responseExpiresIn","replace","createInstallation","fid","endpoint","request","responseValue","registeredInstallationEntry","_b","authVersion","sdkVersion","ok","registrationStatus","sleep","ms","bufferToBase64UrlSafe","buffer","array","Uint8Array","b64","btoa","String","fromCharCode","generateFid","fidByteArray","crypto","getRandomValues","b64String","substr","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","upgradeDB","oldVersion","createObjectStore","set","db","tx","getKey","transaction","objectStore","put","complete","remove","update","updateFn","store","oldValue","newValue","getInstallationEntry","registrationPromise","oldEntry","installationEntry","updateOrCreateFid","entryWithPromise","triggerRegistrationIfNecessary","entry","hasInstallationRequestTimedOut","navigator","onLine","registrationPromiseWithError","inProgressEntry","registrationTime","registerInstallation","waitUntilFidRegistration","e_1","updateInstallationRequest","getId","catch","generateAuthToken","completedAuthToken","getGenerateAuthTokenEndpoint","installation","completeInstallationRegistration","fetchAuthToken","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenValid","waitUntilAuthTokenRequest","makeAuthTokenRequestInProgressEntry","fetchAuthTokenFromServer","updateAuthTokenRequest","hasAuthTokenRequestTimedOut","updatedInstallationEntry","isAuthTokenExpired","inProgressAuthToken","requestTime","deleteInstallation","getDeleteEndpoint","deleteInstallation$1","installationsName","factoryMethod","a","LogLevel","Logger","setLogLevel","instances","defaultLogLevel","INFO","defaultLogHandler","logType","args","_i","logLevel","toISOString","DEBUG","console","log","VERBOSE","info","WARN","warn","ERROR","_logLevel","_logHandler","val","debug","level","forEach","inst"],"mappings":"0HAIA,SAAAA,EAAAC,GAA+B,OAAAA,GAAA,kBAAAA,GAAA,YAAAA,IAAA,WAAAA,EAF/BC,OAAAC,eAAAC,EAAA,cAA8CC,OAAA,IAI9C,IAAAC,EAAAN,EAA+BO,EAAQ,SACvCC,EAAcD,EAAQ,QAyBtBE,EAAA,CACAC,GAAA,KACAC,UAAA,YACAC,QAAA,UACAC,iBAAA,mBACAC,kBAAA,oBACAC,UAAA,YACAC,eAAA,iBACAC,kBAAA,oBACAC,gBAAA,kBACAC,mBAAA,qBACAC,oBAAA,sBACAC,QAAA,UACAC,aAAA,eACAC,cAAA,gBACAC,SAAA,WACAC,YAAA,cACAC,UAAA,aAMAC,EAAA,SAAAC,GAEA,SAAAD,EAAAE,EAAAC,EAAAC,GACA,IAAAC,EAAAJ,EAAAK,KAAAC,KAAAJ,IAAAI,KAOA,OAHAhC,OAAAiC,eAAAH,EAAAL,EAAAS,WACAJ,EAAAH,OACAG,EAAAD,UACAC,EAEA,OAXAxB,EAAA6B,UAAAV,EAAAC,GAWAD,EAZA,CAaCW,OASD,SAAAC,EAAAC,GAEA,GAAAA,GAAA,KAAAA,EAAA,IACA,WAEA,OAAAA,GACA,OAEA,iBACA,SACA,yBACA,SACA,wBACA,SACA,0BACA,SACA,kBACA,SACA,gBACA,SACA,2BACA,SACA,kBACA,SACA,iBACA,SACA,sBACA,SACA,oBACA,SACA,0BAEA,gBAKA,SAAAC,EAAAD,EAAAE,EAAAC,GACA,IAAAd,EAAAU,EAAAC,GAEAI,EAAAf,EACAE,OAAAc,EAEA,IACA,IAAAC,EAAAJ,EAAAK,MACA,GAAAD,EAAA,CACA,IAAAE,EAAAF,EAAAN,OACA,qBAAAQ,EAAA,CACA,IAAAvC,EAAAuC,GAEA,WAAArB,EAAA,uBAEAE,EAAApB,EAAAuC,GAIAJ,EAAAI,EACA,IAAAlB,EAAAgB,EAAAhB,QACA,kBAAAA,IACAc,EAAAd,GAEAC,EAAAe,EAAAf,aACAc,IAAAd,IACAA,EAAAY,EAAAM,OAAAlB,KAIA,MAAAmB,IAGA,aAAArB,EAIA,KAEA,IAAAF,EAAAE,EAAAe,EAAAb,GAMA,IAAAoB,EAAA,WACA,SAAAA,EAAAC,GACAlB,KAAAkB,MAwEA,OAtEAD,EAAAf,UAAAiB,aAAA,WACA,OAAA7C,EAAA8C,UAAApB,UAAA,oBACA,IAAAqB,EACA,OAAA/C,EAAAgD,YAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAEA,OADAD,EAAAE,KAAAC,KAAA,UACA,GAAA1B,KAAAkB,IAAA5B,SAAAqC,YACA,OAEA,OADAN,EAAAE,EAAAK,OACAP,EAGA,GAAAA,EAAAQ,aAFA,QAAAlB,GAGA,OAGA,OAFAY,EAAAK,OAEA,QAAAjB,GACA,uBAKAM,EAAAf,UAAA4B,mBAAA,WACA,OAAAxD,EAAA8C,UAAApB,UAAA,oBACA,IAAA+B,EAAAV,EACA,OAAA/C,EAAAgD,YAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAIA,OAHAD,EAAAE,KAAAC,KAAA,UAGA1B,KAAAkB,IAAAa,WAGAA,EAAA/B,KAAAkB,IAAAa,YACA,GAAAA,EAAAJ,aAHA,QAAAhB,GAIA,OAEA,OADAU,EAAAE,EAAAK,OACAP,EAGA,GAAAA,GAFA,QAAAV,GAGA,OAKA,OAJAY,EAAAK,OAIA,QAAAjB,GACA,uBAKAM,EAAAf,UAAA8B,WAAA,WACA,OAAA1D,EAAA8C,UAAApB,UAAA,oBACA,IAAAiC,EAAAC,EACA,OAAA5D,EAAAgD,YAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,gBAAAxB,KAAAmB,gBACA,OAEA,OADAc,EAAAV,EAAAK,OACA,GAAA5B,KAAA8B,sBACA,OAEA,OADAI,EAAAX,EAAAK,OACA,IAA+CK,YAAAC,0BAK/CjB,EA1EA,GA6FAkB,EAAA,iDACAC,EAAA;;;;;;;;;;;;;;;;GACA,SAAAC,EAAAC,EAAAC,GACA,IAAAC,EAAA,GACA,QAAAC,KAAAH,EACAA,EAAAI,eAAAD,KACAD,EAAAC,GAAAF,EAAAD,EAAAG,KAGA,OAAAD,EAEA,IAAAG,EAAA,WACA,SAAAA,KAmEA,OA/DAA,EAAAzC,UAAA0C,OAAA,SAAAC,GACA,IAAA/C,EAAAE,KACA,UAAA6C,QAAAlC,IAAAkC,EACA,YAKA,GAHAA,aAAAC,SACAD,IAAAE,WAEA,kBAAAF,GAAAG,SAAAH,GAGA,OAAAA,EAEA,QAAAA,IAAA,IAAAA,EACA,OAAAA,EAEA,uBAAA7E,OAAAkC,UAAA+C,SAAAlD,KAAA8C,GACA,OAAAA,EAEA,GAAAK,MAAAC,QAAAN,GACA,OAAAA,EAAAO,IAAA,SAAAC,GAA0C,OAAAvD,EAAA8C,OAAAS,KAE1C,uBAAAR,GAAA,kBAAAA,EACA,OAAAR,EAAAQ,EAAA,SAAAQ,GAAiD,OAAAvD,EAAA8C,OAAAS,KAGjD,UAAAjD,MAAA,mCAAAyC,IAIAF,EAAAzC,UAAAa,OAAA,SAAAuC,GACA,IAAAxD,EAAAE,KACA,UAAAsD,EACA,OAAAA,EAEA,GAAAA,EAAA,SACA,OAAAA,EAAA,UACA,KAAAnB,EAEA,KAAAC,EAIA,IAAAjE,EAAAoF,WAAAD,EAAAnF,OACA,GAAAqF,MAAArF,GACA,UAAAiC,MAAA,qCAAAkD,GAEA,OAAAnF,EAEA,QACA,UAAAiC,MAAA,qCAAAkD,GAIA,OAAAJ,MAAAC,QAAAG,GACAA,EAAAF,IAAA,SAAAC,GAA0C,OAAAvD,EAAAiB,OAAAsC,KAE1C,oBAAAC,GAAA,kBAAAA,EACAjB,EAAAiB,EAAA,SAAAD,GAAiD,OAAAvD,EAAAiB,OAAAsC,KAGjDC,GAEAX,EApEA;;;;;;;;;;;;;;;;GA6FA,SAAAc,EAAAC,GACA,WAAAC,QAAA,SAAAC,EAAAC,GACAC,WAAA,WACAD,EAAA,IAAApE,EAAA,2CACSiE,KAMT,IAAAK,EAAA,WAMA,SAAAA,EAAAC,EAAAC,GACA,IAAAnE,EAAAE,UACA,IAAAiE,IAAiCA,EAAA,eACjCjE,KAAAgE,OACAhE,KAAAiE,UACAjE,KAAAS,WAAA,IAAAkC,EACA3C,KAAAkE,eAAA,KACAlE,KAAAV,SAAA,CACA6E,OAAA,WACA,OAAArE,EAAAsE,kBAGApE,KAAAqE,gBAAA,IAAApD,EAAA+C,GAEAhE,KAAAsE,kBAAA,IAAAX,QAAA,SAAAY,GACAzE,EAAAsE,cAAA,WACA,OAAAG,OAgKA,OA5JAvG,OAAAC,eAAA8F,EAAA7D,UAAA,OACAsE,IAAA,WACA,OAAAxE,KAAAgE,MAEAS,YAAA,EACAC,cAAA,IAMAX,EAAA7D,UAAAyE,KAAA,SAAAC,GACA,IAAAC,EAAA7E,KAAAgE,KAAAc,QAAAD,UACAE,EAAA/E,KAAAiE,QACA,UAAAjE,KAAAkE,eAAA,CACA,IAAAc,EAAAhF,KAAAkE,eACA,OAAAc,EAAA,IAAAH,EAAA,IAAAE,EAAA,IAAAH,EAEA,iBAAAG,EAAA,IAAAF,EAAA,uBAAAD,GASAb,EAAA7D,UAAA+E,qBAAA,SAAAC,GACAlF,KAAAkE,eAAAgB,GAMAnB,EAAA7D,UAAAiF,cAAA,SAAAP,EAAAE,GACA,IAAAhF,EAAAE,KACAoF,EAAA,SAAAvC,GACA,OAAA/C,EAAAC,KAAA6E,EAAA/B,EAAAiC,GAAA,KAEA,OAAAM,GASArB,EAAA7D,UAAAmF,SAAA,SAAAC,EAAAC,EAAAC,GACA,OAAAlH,EAAA8C,UAAApB,UAAA,oBACA,IAAAyF,EAAAnC,EACA,OAAAhF,EAAAgD,YAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OACAgE,EAAAE,OAAA,mCACAnE,EAAAC,MAAA,EACA,OAEA,OADAD,EAAAE,KAAAC,KAAA,UACA,GAAAiE,MAAAL,EAAA,CACAM,OAAA,OACAL,KAAAM,KAAAC,UAAAP,GACAC,aAEA,OAEA,OADAC,EAAAlE,EAAAK,OACA,MACA,OAMA,OALAL,EAAAK,OAKA,IACAtB,OAAA,EACAgD,KAAA,OAEA,OACAA,EAAA,KACA/B,EAAAC,MAAA,EACA,OAEA,OADAD,EAAAE,KAAAC,KAAA,UACA,GAAA+D,EAAAnC,QACA,OAEA,OADAA,EAAA/B,EAAAK,OACA,MACA,OAEA,OADAL,EAAAK,OACA,MACA,iBACAtB,OAAAmF,EAAAnF,OACAgD,eAWAS,EAAA7D,UAAAH,KAAA,SAAA6E,EAAA/B,EAAAiC,GACA,OAAAxG,EAAA8C,UAAApB,UAAA,oBACA,IAAAsF,EAAAC,EAAAC,EAAAO,EAAAC,EAAAP,EAAA5E,EAAAoF,EAAAC,EACA,OAAA5H,EAAAgD,YAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAMA,OALA8D,EAAAtF,KAAA2E,KAAAC,GAEA/B,EAAA7C,KAAAS,WAAAmC,OAAAC,GACA0C,EAAA,CAAgC1C,QAChC2C,EAAA,IAAAW,QACA,GAAAnG,KAAAqE,gBAAArC,cACA,OASA,OARA+D,EAAAxE,EAAAK,OACAmE,EAAA9D,WACAuD,EAAAE,OAAA,0BAAAK,EAAA9D,WAEA8D,EAAA7D,iBACAsD,EAAAE,OAAA,6BAAAK,EAAA7D,iBAEA8D,EAAAlB,EAAAkB,SAAA,IACA,GAAArC,QAAAyC,KAAA,CACApG,KAAAqF,SAAAC,EAAAC,EAAAC,GACA/B,EAAAuC,GACAhG,KAAAsE,qBAEA,OAGA,GAFAmB,EAAAlE,EAAAK,QAEA6D,EACA,UAAAhG,EAAA,wDAGA,GADAoB,EAAAN,EAAAkF,EAAAnF,OAAAmF,EAAAnC,KAAAtD,KAAAS,YACAI,EACA,MAAAA,EAEA,IAAA4E,EAAAnC,KACA,UAAA7D,EAAA,iDAQA,GANAwG,EAAAR,EAAAnC,KAAAT,KAGA,qBAAAoD,IACAA,EAAAR,EAAAnC,KAAAd,QAEA,qBAAAyD,EAEA,UAAAxG,EAAA,8CAGA,OADAyG,EAAAlG,KAAAS,WAAAM,OAAAkF,GACA,IAA+CpD,KAAAqD,UAK/CnC,EAtLA,GA4MAsC,EAAA;;;;;;;;;;;;;;;;GACA,SAAAC,EAAApF,EAAAqF,EAAAxB,GACA,WAAAhB,EAAA7C,EAAA6D,GAEA,SAAAyB,EAAAC,GACA,IAAAC,EAAA,CAEAC,UAAA5C,GAEA0C,EAAAnH,SAAAsH,gBAAAP,EAAAC,EAAAI,OAEA/F,GAEA,GAEA6F,EAAApI,GAEAF,EAAAsI,yDC3kBAnI,EAAAwI,EAAAC,GAAAzI,EAAA0I,EAAAD,EAAA,0CAAAE,KAAA,IAAAC,EAAA5I,EAAA,QAAA6I,EAAA7I,EAAA8I,EAAAF,GAAAG,EAAA/I,EAAA,QAAAgJ,EAAAhJ,EAAA,QAiCA,IAAAiJ,EAAA,WAQA,OAPAA,EAAAtJ,OAAAuJ,QAAA,SAAAC,GACA,QAAAC,EAAAC,EAAA,EAAAP,EAAAQ,UAAAC,OAAgDF,EAAAP,EAAOO,IAEvD,QAAAG,KADAJ,EAAAE,UAAAD,GACAD,EAAAzJ,OAAAkC,UAAAwC,eAAA3C,KAAA0H,EAAAI,KAAAL,EAAAK,GAAAJ,EAAAI,IAEA,OAAAL,GAEAF,EAAAQ,MAAA9H,KAAA2H,YA4BA,SAAAvG,EAAA2G,EAAAC,EAAAC,EAAAC,GACA,WAAAD,MAAAtE,UAAA,SAAAY,EAAAV,GACA,SAAAsE,EAAAhK,GAAmC,IAAMiK,EAAAF,EAAAG,KAAAlK,IAA+B,MAAA6C,GAAY6C,EAAA7C,IACpF,SAAAsH,EAAAnK,GAAkC,IAAMiK,EAAAF,EAAA,SAAA/J,IAAmC,MAAA6C,GAAY6C,EAAA7C,IACvF,SAAAoH,EAAA5F,GAA+BA,EAAA+F,KAAAhE,EAAA/B,EAAArE,OAAA,IAAA8J,EAAA,SAAA1D,GAAiEA,EAAA/B,EAAArE,SAAyBqK,KAAAL,EAAAG,GACzHF,GAAAF,IAAAJ,MAAAC,EAAAC,GAAA,KAAAK,UAIA,SAAA/G,EAAAyG,EAAAxC,GACA,IAAwGhD,EAAAkG,EAAAjB,EAAAkB,EAAxG9E,EAAA,CAAapC,MAAA,EAAAI,KAAA,WAA6B,KAAA4F,EAAA,SAAAA,EAAA,GAA0B,OAAAA,EAAA,IAAe/F,KAAA,GAAAkH,IAAA,IACnF,OAAAD,EAAA,CAAgBL,KAAAO,EAAA,GAAAC,MAAAD,EAAA,GAAAE,OAAAF,EAAA,IAAqD,oBAAAG,SAAAL,EAAAK,OAAAC,UAAA,WAAoE,OAAAhJ,OAAe0I,EACxJ,SAAAE,EAAAzB,GAAsB,gBAAA8B,GAAsB,OAAAb,EAAA,CAAAjB,EAAA8B,KAC5C,SAAAb,EAAAc,GACA,GAAA3G,EAAA,UAAA4G,UAAA,mCACA,MAAAvF,EAAA,IACA,GAAArB,EAAA,EAAAkG,IAAAjB,EAAA,EAAA0B,EAAA,GAAAT,EAAA,UAAAS,EAAA,GAAAT,EAAA,YAAAjB,EAAAiB,EAAA,YAAAjB,EAAAzH,KAAA0I,GAAA,GAAAA,EAAAJ,SAAAb,IAAAzH,KAAA0I,EAAAS,EAAA,KAAAX,KAAA,OAAAf,EAEA,OADAiB,EAAA,EAAAjB,IAAA0B,EAAA,GAAAA,EAAA,GAAA1B,EAAArJ,QACA+K,EAAA,IACA,cAAA1B,EAAA0B,EAAuC,MACvC,OAAkC,OAAlCtF,EAAApC,QAAkC,CAASrD,MAAA+K,EAAA,GAAAX,MAAA,GAC3C,OAAA3E,EAAApC,QAAkCiH,EAAAS,EAAA,GAAWA,EAAA,IAAU,SACvD,OAAAA,EAAAtF,EAAA+E,IAAAS,MAAyCxF,EAAAnC,KAAA2H,MAAc,SACvD,QACA,GAAA5B,EAAA5D,EAAAnC,OAAA+F,IAAAI,OAAA,GAAAJ,IAAAI,OAAA,UAAAsB,EAAA,QAAAA,EAAA,KAA6GtF,EAAA,EAAO,SACpH,OAAAsF,EAAA,MAAA1B,GAAA0B,EAAA,GAAA1B,EAAA,IAAA0B,EAAA,GAAA1B,EAAA,KAAgF5D,EAAApC,MAAA0H,EAAA,GAAiB,MACjG,OAAAA,EAAA,IAAAtF,EAAApC,MAAAgG,EAAA,IAAwD5D,EAAApC,MAAAgG,EAAA,GAAgBA,EAAA0B,EAAQ,MAChF,GAAA1B,GAAA5D,EAAApC,MAAAgG,EAAA,IAA8C5D,EAAApC,MAAAgG,EAAA,GAAgB5D,EAAA+E,IAAAjH,KAAAwH,GAAgB,MAC9E1B,EAAA,IAAA5D,EAAA+E,IAAAS,MACAxF,EAAAnC,KAAA2H,MAAiC,SAEjCF,EAAA3D,EAAAxF,KAAAgI,EAAAnE,GACS,MAAA5C,GAAYkI,EAAA,GAAAlI,GAAayH,EAAA,EAAS,QAAUlG,EAAAiF,EAAA,EACrD,KAAA0B,EAAA,SAAAA,EAAA,GAAmC,OAAS/K,MAAA+K,EAAA,GAAAA,EAAA,UAAAX,MAAA,IAmB5C,SAAAc,EAAA/G,EAAA6E,GACA,IAAAmC,EAAA,oBAAAP,QAAAzG,EAAAyG,OAAAC,UACA,IAAAM,EAAA,OAAAhH,EACA,IAAAuE,EAAA7F,EAAA0G,EAAA4B,EAAAvJ,KAAAuC,GAAAiH,EAAA,GACA,IACA,gBAAApC,QAAA,MAAAN,EAAAa,EAAAW,QAAAE,KAAAgB,EAAA7H,KAAAmF,EAAA1I,OAEA,MAAA0C,GAAmBG,EAAA,CAAMH,SACzB,QACA,IACAgG,MAAA0B,OAAAe,EAAA5B,EAAA,YAAA4B,EAAAvJ,KAAA2H,GAEA,QAAiB,GAAA1G,EAAA,MAAAA,EAAAH,OAEjB,OAAA0I,EAGA,SAAAC,IACA,QAAAD,EAAA,GAAA7B,EAAA,EAA4BA,EAAAC,UAAAC,OAAsBF,IAClD6B,IAAAE,OAAAJ,EAAA1B,UAAAD,KACA,OAAA6B,EAiDA,IA8DAhI,EAxBAmI,EAAA,IACAC,EAAA,UACAC,EAAA,SACAC,EAAA,kDACAC,EAAA,KACAC,EAAA,gBACAC,EAAA,gBAmBAC,GAAA1I,EAAA,GACAA,EAAA,iEACAA,EAAA,0EACAA,EAAA,0DACAA,EAAA,6DACAA,EAAA,6DACAA,EAAA,+GACAA,EAAA,iEACAA,EAAA,0GACAA,GACA2I,EAAA,IAAwB9C,EAAA,gBAAY2C,EAAAC,EAAAC;;;;;;;;;;;;;;;;GAEpC,SAAAE,EAAAtJ,GACA,OAAAA,aAA6BuG,EAAA,kBAC7BvG,EAAAlB,KAAAyK,SAAA;;;;;;;;;;;;;;;;GAmBA,SAAAC,EAAAnJ,GACA,IAAAA,MAAA4D,QACA,MAAAoF,EAAAI,OAAA,6BAEA,IAAAC,EAAArJ,EAAA0D,KACArD,EAAAL,EAAA4D,QAAAD,EAAAtD,EAAAsD,UAAA2F,EAAAjJ,EAAAiJ,OAAAC,EAAAlJ,EAAAkJ,MACA,IAAAF,IAAA1F,IAAA2F,IAAAC,EACA,MAAAP,EAAAI,OAAA,6BAEA,OAAYC,UAAA1F,YAAA2F,SAAAC;;;;;;;;;;;;;;;;GAmBZ,SAAAC,EAAAnJ,GACA,IAAAsD,EAAAtD,EAAAsD,UACA,OAAAgF,EAAA,aAAAhF,EAAA,iBAEA,SAAA8F,EAAAlF,GACA,OACApE,MAAAoE,EAAApE,MACAuJ,cAAA,EACAC,UAAAC,EAAArF,EAAAoF,WACAE,aAAAC,KAAAC,OAGA,SAAAC,EAAAC,EAAA1F,GACA,OAAArE,EAAApB,UAAA,oBACA,IAAAoL,EAAAC,EACA,OAAA/J,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,gBAAAiE,EAAAnC,QACA,OAGA,OAFA8H,EAAA7J,EAAAK,OACAyJ,EAAAD,EAAAvK,MACA,GAAAqJ,EAAAI,OAAA,kBACAa,cACAG,WAAAD,EAAA1L,KACA4L,cAAAF,EAAAzL,QACA4L,aAAAH,EAAA/K,eAMA,SAAAmL,EAAAlK,GACA,IAAAiJ,EAAAjJ,EAAAiJ,OACA,WAAArE,QAAA,CACAuF,eAAA,mBACAC,OAAA,mBACAC,iBAAApB,IAGA,SAAAqB,EAAAC,EAAAvK,GACA,IAAAwK,EAAAxK,EAAAwK,aACAvG,EAAAiG,EAAAK,GAEA,OADAtG,EAAAE,OAAA,gBAAAsG,EAAAD,IACAvG,EAEA,SAAAsF,EAAAmB,GAEA,OAAAnJ,OAAAmJ,EAAAC,QAAA,YAEA,SAAAF,EAAAD,GACA,OAAAnC,EAAA,IAAAmC;;;;;;;;;;;;;;;;GAmBA,SAAAI,EAAAL,EAAAvK,GACA,IAAA6K,EAAA7K,EAAA6K,IACA,OAAAhL,EAAApB,UAAA,oBACA,IAAAqM,EAAA7G,EAAAD,EAAA+G,EAAA7G,EAAA8G,EAAAC,EACA,OAAAlL,EAAAtB,KAAA,SAAAyM,GACA,OAAAA,EAAAjL,OACA,OAcA,OAbA6K,EAAA3B,EAAAoB,GACAtG,EAAAiG,EAAAK,GACAvG,EAAA,CACA6G,MACAM,YAAA9C,EACAa,MAAAqB,EAAArB,MACAkC,WAAAhD,GAEA2C,EAAA,CACA1G,OAAA,OACAJ,UACAD,KAAAM,KAAAC,UAAAP,IAEA,GAAAI,MAAA0G,EAAAC,IACA,OAEA,OADA7G,EAAAgH,EAAA7K,OACA6D,EAAAmH,GACA,GAAAnH,EAAAnC,QADA,MAEA,OAQA,OAPAiJ,EAAAE,EAAA7K,OACA4K,EAAA,CACAJ,MACAS,mBAAA,EACAd,aAAAQ,EAAAR,aACA9J,UAAA0I,EAAA4B,EAAAtK,YAEA,GAAAuK,GACA,aAAAtB,EAAA,sBAAAzF;;;;;;;;;;;;;;;;GAuBA,SAAAqH,EAAAC,GACA,WAAApJ,QAAA,SAAAY,GACAT,WAAAS,EAAAwI;;;;;;;;;;;;;;;;GAoBA,SAAAC,EAAAC,GACA,IAAAC,EAAAD,aAAAE,WAAAF,EAAA,IAAAE,WAAAF,GACAG,EAAAC,KAAAC,OAAAC,aAAAzF,MAAAwF,OAAA9D,EAAA0D,KACA,OAAAE,EAAAlB,QAAA,WAAAA,QAAA;;;;;;;;;;;;;;;;GAoBA,SAAAsB,IAGA,IAAAC,EAAA,IAAAN,WAAA,IAIA,OAHAO,OAAAC,gBAAAF,GAEAA,EAAA,OAAAA,EAAA,MACA7K,EAAA6K,GAGA,SAAA7K,EAAA6K,GACA,IAAAG,EAAAZ,EAAAS,GAGA,OAAAG,EAAAC,OAAA;;;;;;;;;;;;;;;;GAmBA,IAAAC,EAAA,kCACAC,EAAA,EACAC,EAAA,+BACAC,EAAgBjQ,OAAAqJ,EAAA,UAAArJ,CAAM8P,EAAAC,EAAA,SAAAG,GAKtB,OAAAA,EAAAC,YACA,OACAD,EAAAE,kBAAAJ,MAIA,SAAAK,EAAAvC,EAAA3N,GACA,OAAAiD,EAAApB,UAAA,oBACA,IAAAyC,EAAA6L,EAAAC,EACA,OAAAjN,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAEA,OADAiB,EAAA+L,EAAA1C,GACA,GAAAmC,GACA,OAIA,OAHAK,EAAA/M,EAAAK,OACA2M,EAAAD,EAAAG,YAAAT,EAAA,aACAO,EAAAG,YAAAV,GAAAW,IAAAxQ,EAAAsE,GACA,GAAA8L,EAAAK,UACA,OAEA,OADArN,EAAAK,OACA,GAAAzD,QAMA,SAAA0Q,EAAA/C,GACA,OAAA1K,EAAApB,UAAA,oBACA,IAAAyC,EAAA6L,EAAAC,EACA,OAAAjN,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAEA,OADAiB,EAAA+L,EAAA1C,GACA,GAAAmC,GACA,OAIA,OAHAK,EAAA/M,EAAAK,OACA2M,EAAAD,EAAAG,YAAAT,EAAA,aACAO,EAAAG,YAAAV,GAAA7J,OAAA1B,GACA,GAAA8L,EAAAK,eAWA,SAAAE,EAAAhD,EAAAiD,GACA,OAAA3N,EAAApB,UAAA,oBACA,IAAAyC,EAAA6L,EAAAC,EAAAS,EAAAC,EAAAC,EACA,OAAA5N,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAEA,OADAiB,EAAA+L,EAAA1C,GACA,GAAAmC,GACA,OAIA,OAHAK,EAAA/M,EAAAK,OACA2M,EAAAD,EAAAG,YAAAT,EAAA,aACAgB,EAAAT,EAAAG,YAAAV,GACA,GAAAgB,EAAAxK,IAAA/B,IACA,OAGA,OAFAwM,EAAA1N,EAAAK,OACAsN,EAAAH,EAAAE,GACAC,IAAAD,EACA,GAAAC,SAEAvO,IAAAuO,EACAF,EAAA7K,OAAA1B,GAGAuM,EAAAL,IAAAO,EAAAzM,GAEA,GAAA8L,EAAAK,WACA,OAEA,OADArN,EAAAK,OACA,GAAAsN,QAKA,SAAAV,EAAA1C,GACA,OAAAA,EAAAvB,QAAA,IAAAuB,EAAArB;;;;;;;;;;;;;;;;GAuBA,SAAA0E,EAAArD,GACA,OAAA1K,EAAApB,UAAA,oBACA,IAAAoP,EAAA7N,EACA,OAAAD,EAAAtB,KAAA,SAAAyM,GACA,OAAAA,EAAAjL,OACA,OAEA,OADAD,EAAA,GACA,GAAAuN,EAAAhD,EAAA,SAAAuD,GACA,IAAAC,EAAAC,EAAAF,GACAG,EAAAC,EAAA3D,EAAAwD,GAEA,OADAF,EAAAI,EAAAJ,oBACAI,EAAAF,qBAEA,iBAAA/N,EAAA+N,kBAAA7C,EAAA7K,OACAL,EAAA6N,sBACA7N,SAKA,SAAAgO,EAAAF,GACA,IAAAK,EAAAL,GAAA,CACAjD,IAAAoB,IACAX,mBAAA,GAEA,OAAA8C,EAAAD,GACA,CACAtD,IAAAsD,EAAAtD,IACAS,mBAAA,GAGA6C,EAMA,SAAAD,EAAA3D,EAAAwD,GACA,OAAAA,EAAAzC,mBAAA,CACA,IAAA+C,UAAAC,OAAA,CAEA,IAAAC,EAAAnM,QAAAE,OAAAqG,EAAAI,OAAA,gBACA,OACAgF,oBACAF,oBAAAU,GAIA,IAAAC,EAAA,CACA3D,IAAAkD,EAAAlD,IACAS,mBAAA,EACAmD,iBAAAhF,KAAAC,OAEAmE,EAAAa,EAAAnE,EAAAiE,GACA,OAAgBT,kBAAAS,EAAAX,uBAEhB,WAAAE,EAAAzC,mBACA,CACAyC,oBACAF,oBAAAc,EAAApE,IAIA,CAAgBwD,qBAIhB,SAAAW,EAAAnE,EAAAwD,GACA,OAAAlO,EAAApB,UAAA,oBACA,IAAAwM,EAAA2D,EACA,OAAA7O,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAEA,OADAD,EAAAE,KAAAC,KAAA,UACA,GAAAyK,EAAAL,EAAAwD,IACA,OAEA,OADA9C,EAAAjL,EAAAK,OACA,GAAAyM,EAAAvC,EAAAU,IACA,OAEA,OADAjL,EAAAK,OACA,MACA,OAEA,OADAuO,EAAA5O,EAAAK,OACAuI,EAAAgG,IAAA,MAAAA,EAAA7E,WAGA,GAAAuD,EAAA/C,IAHA,MAIA,OAIA,OADAvK,EAAAK,OACA,MACA,OAEA,SAAAyM,EAAAvC,EAAA,CACAM,IAAAkD,EAAAlD,IACAS,mBAAA,KAEA,OAEAtL,EAAAK,OACAL,EAAAC,MAAA,EACA,aAAA2O,EACA,sBAMA,SAAAD,EAAApE,GACA,OAAA1K,EAAApB,UAAA,oBACA,IAAA0P,EACA,OAAApO,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,gBAAA4O,EAAAtE,IACA,OACA4D,EAAAnO,EAAAK,OACAL,EAAAC,MAAA,EACA,OACA,WAAAkO,EAAA7C,mBAAA,MAEA,GAAAC,EAAA,MACA,OAGA,OADAvL,EAAAK,OACA,GAAAwO,EAAAtE,IACA,OAEA,OADA4D,EAAAnO,EAAAK,OACA,MACA,OACA,OAAA8N,EAAA7C,mBACA,MAAA3C,EAAAI,OAAA,8BAEA,eAaA,SAAA8F,EAAAtE,GACA,OAAAgD,EAAAhD,EAAA,SAAAuD,GACA,IAAAA,EACA,MAAAnF,EAAAI,OAAA,0BAEA,OAAAqF,EAAAN,GACA,CACAjD,IAAAiD,EAAAjD,IACAS,mBAAA,GAGAwC,IAGA,SAAAM,EAAAL,GACA,WAAAA,EAAAzC,oBACAyC,EAAAU,iBAAAtG,EAAAsB,KAAAC;;;;;;;;;;;;;;;;GAmBA,SAAAoF,EAAAnP,GACA,OAAAE,EAAApB,UAAA,oBACA,IAAA8L,EAAAvK,EAAA+N,EAAAF,EACA,OAAA9N,EAAAtB,KAAA,SAAAyM,GACA,OAAAA,EAAAjL,OACA,OAEA,OADAsK,EAAAzB,EAAAnJ,GACA,GAAAiO,EAAArD,IACA,OAMA,OALAvK,EAAAkL,EAAA7K,OAAA0N,EAAA/N,EAAA+N,kBAAAF,EAAA7N,EAAA6N,oBACAA,GAEAA,EAAAkB,MAAA,cAEA,GAAAhB,EAAAlD;;;;;;;;;;;;;;;;GAsBA,SAAAmE,EAAAzE,EAAAwD,GACA,OAAAlO,EAAApB,UAAA,oBACA,IAAAqM,EAAA7G,EAAAD,EAAA+G,EAAA7G,EAAA8G,EAAAiE,EACA,OAAAlP,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAaA,OAZA6K,EAAAoE,EAAA3E,EAAAwD,GACA9J,EAAAqG,EAAAC,EAAAwD,GACA/J,EAAA,CACAmL,aAAA,CACA/D,WAAAhD,IAGA2C,EAAA,CACA1G,OAAA,OACAJ,UACAD,KAAAM,KAAAC,UAAAP,IAEA,GAAAI,MAAA0G,EAAAC,IACA,OAEA,OADA7G,EAAAlE,EAAAK,OACA6D,EAAAmH,GACA,GAAAnH,EAAAnC,QADA,MAEA,OAGA,OAFAiJ,EAAAhL,EAAAK,OACA4O,EAAA7F,EAAA4B,GACA,GAAAiE,GACA,aAAAtF,EAAA,sBAAAzF,QAKA,SAAAgL,EAAA3E,EAAAvK,GACA,IAAA6K,EAAA7K,EAAA6K,IACA,OAAA1B,EAAAoB,GAAA,IAAAM,EAAA;;;;;;;;;;;;;;;;GAmBA,SAAAzK,GAAAT,GACA,OAAAE,EAAApB,UAAA,oBACA,IAAA8L,EACA,OAAAxK,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAEA,OADAsK,EAAAzB,EAAAnJ,GACA,GAAAyP,GAAA7E,IACA,OAIA,OAHAvK,EAAAK,OAGA,GAAAgP,GAAA9E,SAKA,SAAA6E,GAAA7E,GACA,OAAA1K,EAAApB,UAAA,oBACA,IAAAuB,EAAA+N,EAAAF,EACA,OAAA9N,EAAAtB,KAAA,SAAAyM,GACA,OAAAA,EAAAjL,OACA,gBAAA2N,EAAArD,IACA,OAEA,OADAvK,EAAAkL,EAAA7K,OAAA0N,EAAA/N,EAAA+N,kBAAAF,EAAA7N,EAAA6N,oBACAA,EAEA,GAAAA,GAFA,MAGA,OAGA,OADA3C,EAAA7K,OACA,MACA,OACA,OAAA0N,EAAAzC,mBAEA,MAAA3C,EAAAI,OAAA,8BAEAmC,EAAAjL,MAAA,EACA,sBAKA,SAAAoP,GAAA9E,GACA,OAAA1K,EAAApB,UAAA,oBACA,IAAA6Q,EAAAnB,EAAAzN,EAAAV,EACA,OAAAD,EAAAtB,KAAA,SAAAyM,GACA,OAAAA,EAAAjL,OACA,gBAAAsN,EAAAhD,EAAA,SAAAuD,GACA,IAAAyB,GAAAzB,GACA,MAAAnF,EAAAI,OAAA,kBAEA,IAAAyG,EAAA1B,EAAApN,UACA,GAAA+O,GAAAD,GAEA,OAAA1B,EAEA,OAAA0B,EAAAnG,cAGA,OADAiG,EAAAI,GAAAnF,GACAuD,EAIA,IAAAO,UAAAC,OACA,MAAA3F,EAAAI,OAAA,eAEA,IAAAyF,EAAAmB,GAAA7B,GAEA,OADAwB,EAAAM,GAAArF,EAAAiE,GACAA,KAGA,OAEA,OADAL,EAAAjD,EAAA7K,OACAiP,EACA,GAAAA,GADA,MAEA,OAEA,OADAtP,EAAAkL,EAAA7K,OACA,MACA,OACAL,EAAAmO,EAAAzN,UACAwK,EAAAjL,MAAA,EACA,OAEA,OADAS,EAAAV,EACA,GAAAU,EAAAZ,YAQA,SAAA4P,GAAAnF,GACA,OAAA1K,EAAApB,UAAA,oBACA,IAAA0P,EAAAzN,EACA,OAAAX,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,gBAAA4P,GAAAtF,IACA,OACA4D,EAAAnO,EAAAK,OACAL,EAAAC,MAAA,EACA,OACA,WAAAkO,EAAAzN,UAAA2I,cAAA,MAEA,GAAAkC,EAAA,MACA,OAGA,OADAvL,EAAAK,OACA,GAAAwP,GAAAtF,IACA,OAEA,OADA4D,EAAAnO,EAAAK,OACA,MACA,OAEA,GADAK,EAAAyN,EAAAzN,UACA,IAAAA,EAAA2I,cACA,MAAAV,EAAAI,OAAA,yBAGA,SAAArI,QAeA,SAAAmP,GAAAtF,GACA,OAAAgD,EAAAhD,EAAA,SAAAuD,GACA,IAAAyB,GAAAzB,GACA,MAAAnF,EAAAI,OAAA,kBAEA,IAAAyG,EAAA1B,EAAApN,UACA,OAAAoP,GAAAN,GACAzJ,EAAA,GAA8B+H,EAAA,CAAapN,UAAA,CAAa2I,cAAA,KAExDyE,IAGA,SAAA8B,GAAArF,EAAAwD,GACA,OAAAlO,EAAApB,UAAA,oBACA,IAAAiC,EAAAkO,EAAAmB,EACA,OAAAhQ,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAEA,OADAD,EAAAE,KAAAC,KAAA,UACA,GAAA6O,EAAAzE,EAAAwD,IACA,OAGA,OAFArN,EAAAV,EAAAK,OACA0P,EAAAhK,EAAA,GAA0DgI,EAAA,CAAsBrN,cAChF,GAAAoM,EAAAvC,EAAAwF,IACA,OAEA,OADA/P,EAAAK,OACA,GAAAK,GACA,OAEA,OADAkO,EAAA5O,EAAAK,QACAuI,EAAAgG,IAAA,MAAAA,EAAA7E,YAAA,MAAA6E,EAAA7E,WAAA,MAGA,GAAAuD,EAAA/C,IACA,OAIA,OADAvK,EAAAK,OACA,MACA,OAEA,OADA0P,EAAAhK,EAAA,GAA0DgI,EAAA,CAAsBrN,UAAA,CAAa2I,cAAA,KAC7F,GAAAyD,EAAAvC,EAAAwF,IACA,OACA/P,EAAAK,OACAL,EAAAC,MAAA,EACA,aAAA2O,EACA,sBAKA,SAAAW,GAAAxB,GACA,YAAA3O,IAAA2O,GACA,IAAAA,EAAAzC,mBAEA,SAAAmE,GAAA/O,GACA,WAAAA,EAAA2I,gBACA2G,GAAAtP,GAEA,SAAAsP,GAAAtP,GACA,IAAAgJ,EAAAD,KAAAC,MACA,OAAAA,EAAAhJ,EAAA8I,cACA9I,EAAA8I,aAAA9I,EAAA4I,UAAAI,EAAAnB,EAGA,SAAAoH,GAAA7B,GACA,IAAAmC,EAAA,CACA5G,cAAA,EACA6G,YAAAzG,KAAAC,OAEA,OAAA3D,EAAA,GAAsB+H,EAAA,CAAapN,UAAAuP,IAEnC,SAAAH,GAAApP,GACA,WAAAA,EAAA2I,eACA3I,EAAAwP,YAAA/H,EAAAsB,KAAAC;;;;;;;;;;;;;;;;GAmBA,SAAAyG,GAAA5F,EAAAwD,GACA,OAAAlO,EAAApB,UAAA,oBACA,IAAAqM,EAAA7G,EAAA8G,EAAA7G,EACA,OAAAnE,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAOA,OANA6K,EAAAsF,GAAA7F,EAAAwD,GACA9J,EAAAqG,EAAAC,EAAAwD,GACAhD,EAAA,CACA1G,OAAA,SACAJ,WAEA,GAAAG,MAAA0G,EAAAC,IACA,OAEA,GADA7G,EAAAlE,EAAAK,QACA6D,EAAAmH,GACA,MAAA1B,EAAA,sBAAAzF,GAEA,eAKA,SAAAkM,GAAA7F,EAAAvK,GACA,IAAA6K,EAAA7K,EAAA6K,IACA,OAAA1B,EAAAoB,GAAA,IAAAM;;;;;;;;;;;;;;;;GAmBA,SAAAwF,GAAA1Q,GACA,OAAAE,EAAApB,UAAA,oBACA,IAAA8L,EAAA4D,EACA,OAAApO,EAAAtB,KAAA,SAAAuB,GACA,OAAAA,EAAAC,OACA,OAEA,OADAsK,EAAAzB,EAAAnJ,GACA,GAAA4N,EAAAhD,EAAA,SAAAuD,GACA,IAAAA,GACA,IAAAA,EAAAxC,mBAIA,OAAAwC,KAEA,OAEA,GADAK,EAAAnO,EAAAK,QACA8N,EAAA,YACA,OAAAA,EAAA7C,mBAAA,YAEA,MAAA3C,EAAAI,OAAA,+BACA,OACA,OAAAoF,EAAA7C,mBAAA,YACA,GAAA+C,UAAAC,OAAA,YACA,MAAA3F,EAAAI,OAAA,eACA,gBAAAoH,GAAA5F,EAAA4D,IACA,OAEA,OADAnO,EAAAK,OACA,GAAAiN,EAAA/C,IACA,OACAvK,EAAAK,OACAL,EAAAC,MAAA,EACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAuCA,SAAAwF,GAAAP,GACA,IAAAoL,EAAA,gBACAC,EAAA,SAAA5Q,GAGA,OADAmJ,EAAAnJ,GACA,CACAA,MACAmP,MAAA,WAAgC,OAAAA,EAAAnP,IAChCS,SAAA,WAAmC,OAAAA,GAAAT,IACnCiD,OAAA,WAAiC,OAAAyN,GAAA1Q,MAGjCuF,EAAAnH,SAAAsH,gBAAAiL,EAAAC,GAEA9K,GAAsBE,EAAA6K,sCCzuCtB1T,EAAAwI,EAAAC,GAAAzI,EAAA0I,EAAAD,EAAA,6BAAAkL,IAAA3T,EAAA0I,EAAAD,EAAA,2BAAAmL,IAAA5T,EAAA0I,EAAAD,EAAA,gCAAAoL;;;;;;;;;;;;;;;;;AAmBA,IAYAF,EAZAG,EAAA,IAaA,SAAAH,GACAA,IAAA,oBACAA,IAAA,wBACAA,IAAA,kBACAA,IAAA,kBACAA,IAAA,oBACAA,IAAA,uBANA,CAOCA,MAAA,KAID,IAAAI,EAAAJ,EAAAK,KAMAC,EAAA,SAAA7L,EAAA8L,GAEA,IADA,IAAAC,EAAA,GACAC,EAAA,EAAoBA,EAAA9K,UAAAC,OAAuB6K,IAC3CD,EAAAC,EAAA,GAAA9K,UAAA8K,GAEA,KAAAF,EAAA9L,EAAAiM,UAAA,CAEA,IAAAzH,GAAA,IAAAD,MAAA2H,cACA,OAAAJ,GAOA,KAAAP,EAAAY,MACAC,QAAAC,IAAAhL,MAAA+K,QAAA,KAAA5H,EAAA,MAAAxE,EAAA7B,KAAA,KAAA6E,OAAA+I,IACA,MACA,KAAAR,EAAAe,QACAF,QAAAC,IAAAhL,MAAA+K,QAAA,KAAA5H,EAAA,MAAAxE,EAAA7B,KAAA,KAAA6E,OAAA+I,IACA,MACA,KAAAR,EAAAK,KACAQ,QAAAG,KAAAlL,MAAA+K,QAAA,KAAA5H,EAAA,MAAAxE,EAAA7B,KAAA,KAAA6E,OAAA+I,IACA,MACA,KAAAR,EAAAiB,KACAJ,QAAAK,KAAApL,MAAA+K,QAAA,KAAA5H,EAAA,MAAAxE,EAAA7B,KAAA,KAAA6E,OAAA+I,IACA,MACA,KAAAR,EAAAmB,MACAN,QAAAhS,MAAAiH,MAAA+K,QAAA,KAAA5H,EAAA,MAAAxE,EAAA7B,KAAA,KAAA6E,OAAA+I,IACA,MACA,QACA,UAAApS,MAAA,8DAAAmS,EAAA,QAGAN,EAAA,WAOA,SAAAA,EAAArN,GACA5E,KAAA4E,OAIA5E,KAAAoT,UAAAhB,EAIApS,KAAAqT,YAAAf,EAIAH,EAAAzQ,KAAA1B,MAkEA,OAhEAhC,OAAAC,eAAAgU,EAAA/R,UAAA,YACAsE,IAAA,WACA,OAAAxE,KAAAoT,WAEA/E,IAAA,SAAAiF,GACA,KAAAA,KAAAtB,GACA,UAAA7I,UAAA,wCAEAnJ,KAAAoT,UAAAE,GAEA7O,YAAA,EACAC,cAAA,IAEA1G,OAAAC,eAAAgU,EAAA/R,UAAA,cACAsE,IAAA,WACA,OAAAxE,KAAAqT,aAEAhF,IAAA,SAAAiF,GACA,uBAAAA,EACA,UAAAnK,UAAA,qDAEAnJ,KAAAqT,YAAAC,GAEA7O,YAAA,EACAC,cAAA,IAKAuN,EAAA/R,UAAAqT,MAAA,WAEA,IADA,IAAAf,EAAA,GACAC,EAAA,EAAwBA,EAAA9K,UAAAC,OAAuB6K,IAC/CD,EAAAC,GAAA9K,UAAA8K,GAEAzS,KAAAqT,YAAAvL,MAAA9H,KAAA,CAAAA,KAAAgS,EAAAY,OAAAnJ,OAAA+I,KAEAP,EAAA/R,UAAA4S,IAAA,WAEA,IADA,IAAAN,EAAA,GACAC,EAAA,EAAwBA,EAAA9K,UAAAC,OAAuB6K,IAC/CD,EAAAC,GAAA9K,UAAA8K,GAEAzS,KAAAqT,YAAAvL,MAAA9H,KAAA,CAAAA,KAAAgS,EAAAe,SAAAtJ,OAAA+I,KAEAP,EAAA/R,UAAA8S,KAAA,WAEA,IADA,IAAAR,EAAA,GACAC,EAAA,EAAwBA,EAAA9K,UAAAC,OAAuB6K,IAC/CD,EAAAC,GAAA9K,UAAA8K,GAEAzS,KAAAqT,YAAAvL,MAAA9H,KAAA,CAAAA,KAAAgS,EAAAK,MAAA5I,OAAA+I,KAEAP,EAAA/R,UAAAgT,KAAA,WAEA,IADA,IAAAV,EAAA,GACAC,EAAA,EAAwBA,EAAA9K,UAAAC,OAAuB6K,IAC/CD,EAAAC,GAAA9K,UAAA8K,GAEAzS,KAAAqT,YAAAvL,MAAA9H,KAAA,CAAAA,KAAAgS,EAAAiB,MAAAxJ,OAAA+I,KAEAP,EAAA/R,UAAAW,MAAA,WAEA,IADA,IAAA2R,EAAA,GACAC,EAAA,EAAwBA,EAAA9K,UAAAC,OAAuB6K,IAC/CD,EAAAC,GAAA9K,UAAA8K,GAEAzS,KAAAqT,YAAAvL,MAAA9H,KAAA,CAAAA,KAAAgS,EAAAmB,OAAA1J,OAAA+I,KAEAP,EAtFA;;;;;;;;;;;;;;;;;AAyGA,SAAAC,EAAAsB,GACArB,EAAAsB,QAAA,SAAAC,GACAA,EAAAhB,SAAAc","file":"js/chunk-vendors~53f0764e.53d19d44.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nfunction _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }\n\nvar firebase = _interopDefault(require('@firebase/app'));\nvar tslib_1 = require('tslib');\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Standard error codes for different ways a request can fail, as defined by:\r\n * https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto\r\n *\r\n * This map is used primarily to convert from a backend error code string to\r\n * a client SDK error code string, and make sure it's in the supported set.\r\n */\r\nvar errorCodeMap = {\r\n    OK: 'ok',\r\n    CANCELLED: 'cancelled',\r\n    UNKNOWN: 'unknown',\r\n    INVALID_ARGUMENT: 'invalid-argument',\r\n    DEADLINE_EXCEEDED: 'deadline-exceeded',\r\n    NOT_FOUND: 'not-found',\r\n    ALREADY_EXISTS: 'already-exists',\r\n    PERMISSION_DENIED: 'permission-denied',\r\n    UNAUTHENTICATED: 'unauthenticated',\r\n    RESOURCE_EXHAUSTED: 'resource-exhausted',\r\n    FAILED_PRECONDITION: 'failed-precondition',\r\n    ABORTED: 'aborted',\r\n    OUT_OF_RANGE: 'out-of-range',\r\n    UNIMPLEMENTED: 'unimplemented',\r\n    INTERNAL: 'internal',\r\n    UNAVAILABLE: 'unavailable',\r\n    DATA_LOSS: 'data-loss'\r\n};\r\n/**\r\n * An explicit error that can be thrown from a handler to send an error to the\r\n * client that called the function.\r\n */\r\nvar HttpsErrorImpl = /** @class */ (function (_super) {\r\n    tslib_1.__extends(HttpsErrorImpl, _super);\r\n    function HttpsErrorImpl(code, message, details) {\r\n        var _this = _super.call(this, message) || this;\r\n        // This is a workaround for a bug in TypeScript when extending Error:\r\n        // tslint:disable-next-line\r\n        // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\r\n        Object.setPrototypeOf(_this, HttpsErrorImpl.prototype);\r\n        _this.code = code;\r\n        _this.details = details;\r\n        return _this;\r\n    }\r\n    return HttpsErrorImpl;\r\n}(Error));\r\n/**\r\n * Takes an HTTP status code and returns the corresponding ErrorCode.\r\n * This is the standard HTTP status code -> error mapping defined in:\r\n * https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto\r\n *\r\n * @param status An HTTP status code.\r\n * @return The corresponding ErrorCode, or ErrorCode.UNKNOWN if none.\r\n */\r\nfunction codeForHTTPStatus(status) {\r\n    // Make sure any successful status is OK.\r\n    if (status >= 200 && status < 300) {\r\n        return 'ok';\r\n    }\r\n    switch (status) {\r\n        case 0:\r\n            // This can happen if the server returns 500.\r\n            return 'internal';\r\n        case 400:\r\n            return 'invalid-argument';\r\n        case 401:\r\n            return 'unauthenticated';\r\n        case 403:\r\n            return 'permission-denied';\r\n        case 404:\r\n            return 'not-found';\r\n        case 409:\r\n            return 'aborted';\r\n        case 429:\r\n            return 'resource-exhausted';\r\n        case 499:\r\n            return 'cancelled';\r\n        case 500:\r\n            return 'internal';\r\n        case 501:\r\n            return 'unimplemented';\r\n        case 503:\r\n            return 'unavailable';\r\n        case 504:\r\n            return 'deadline-exceeded';\r\n    }\r\n    return 'unknown';\r\n}\r\n/**\r\n * Takes an HTTP response and returns the corresponding Error, if any.\r\n */\r\nfunction _errorForResponse(status, bodyJSON, serializer) {\r\n    var code = codeForHTTPStatus(status);\r\n    // Start with reasonable defaults from the status code.\r\n    var description = code;\r\n    var details = undefined;\r\n    // Then look through the body for explicit details.\r\n    try {\r\n        var errorJSON = bodyJSON.error;\r\n        if (errorJSON) {\r\n            var status_1 = errorJSON.status;\r\n            if (typeof status_1 === 'string') {\r\n                if (!errorCodeMap[status_1]) {\r\n                    // They must've included an unknown error code in the body.\r\n                    return new HttpsErrorImpl('internal', 'internal');\r\n                }\r\n                code = errorCodeMap[status_1];\r\n            }\r\n            // TODO(klimt): Add better default descriptions for error enums.\r\n            // The default description needs to be updated for the new code.\r\n            description = status_1;\r\n            var message = errorJSON.message;\r\n            if (typeof message === 'string') {\r\n                description = message;\r\n            }\r\n            details = errorJSON.details;\r\n            if (details !== undefined) {\r\n                details = serializer.decode(details);\r\n            }\r\n        }\r\n    }\r\n    catch (e) {\r\n        // If we couldn't parse explicit error data, that's fine.\r\n    }\r\n    if (code === 'ok') {\r\n        // Technically, there's an edge case where a developer could explicitly\r\n        // return an error code of OK, and we will treat it as success, but that\r\n        // seems reasonable.\r\n        return null;\r\n    }\r\n    return new HttpsErrorImpl(code, description, details);\r\n}\n\n/**\r\n * Helper class to get metadata that should be included with a function call.\r\n */\r\nvar ContextProvider = /** @class */ (function () {\r\n    function ContextProvider(app) {\r\n        this.app = app;\r\n    }\r\n    ContextProvider.prototype.getAuthToken = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var token, e_1;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4 /*yield*/, this.app.INTERNAL.getToken()];\r\n                    case 1:\r\n                        token = _a.sent();\r\n                        if (!token) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        return [2 /*return*/, token.accessToken];\r\n                    case 2:\r\n                        e_1 = _a.sent();\r\n                        // If there's any error when trying to get the auth token, leave it off.\r\n                        return [2 /*return*/, undefined];\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ContextProvider.prototype.getInstanceIdToken = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var messaging, token, e_2;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        // HACK: Until we have a separate instanceId package, this is a quick way\r\n                        // to load in the messaging instance for this app.\r\n                        if (!this.app.messaging) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        messaging = this.app.messaging();\r\n                        return [4 /*yield*/, messaging.getToken()];\r\n                    case 1:\r\n                        token = _a.sent();\r\n                        if (!token) {\r\n                            return [2 /*return*/, undefined];\r\n                        }\r\n                        return [2 /*return*/, token];\r\n                    case 2:\r\n                        e_2 = _a.sent();\r\n                        // We don't warn on this, because it usually means messaging isn't set up.\r\n                        // console.warn('Failed to retrieve instance id token.', e);\r\n                        // If there's any error when trying to get the token, leave it off.\r\n                        return [2 /*return*/, undefined];\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ContextProvider.prototype.getContext = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var authToken, instanceIdToken;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getAuthToken()];\r\n                    case 1:\r\n                        authToken = _a.sent();\r\n                        return [4 /*yield*/, this.getInstanceIdToken()];\r\n                    case 2:\r\n                        instanceIdToken = _a.sent();\r\n                        return [2 /*return*/, { authToken: authToken, instanceIdToken: instanceIdToken }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return ContextProvider;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar LONG_TYPE = 'type.googleapis.com/google.protobuf.Int64Value';\r\nvar UNSIGNED_LONG_TYPE = 'type.googleapis.com/google.protobuf.UInt64Value';\r\nfunction mapValues(o, f) {\r\n    var result = {};\r\n    for (var key in o) {\r\n        if (o.hasOwnProperty(key)) {\r\n            result[key] = f(o[key]);\r\n        }\r\n    }\r\n    return result;\r\n}\r\nvar Serializer = /** @class */ (function () {\r\n    function Serializer() {\r\n    }\r\n    // Takes data and encodes it in a JSON-friendly way, such that types such as\r\n    // Date are preserved.\r\n    Serializer.prototype.encode = function (data) {\r\n        var _this = this;\r\n        if (data === null || data === undefined) {\r\n            return null;\r\n        }\r\n        if (data instanceof Number) {\r\n            data = data.valueOf();\r\n        }\r\n        if (typeof data === 'number' && isFinite(data)) {\r\n            // Any number in JS is safe to put directly in JSON and parse as a double\r\n            // without any loss of precision.\r\n            return data;\r\n        }\r\n        if (data === true || data === false) {\r\n            return data;\r\n        }\r\n        if (Object.prototype.toString.call(data) === '[object String]') {\r\n            return data;\r\n        }\r\n        if (Array.isArray(data)) {\r\n            return data.map(function (x) { return _this.encode(x); });\r\n        }\r\n        if (typeof data === 'function' || typeof data === 'object') {\r\n            return mapValues(data, function (x) { return _this.encode(x); });\r\n        }\r\n        // If we got this far, the data is not encodable.\r\n        throw new Error('Data cannot be encoded in JSON: ' + data);\r\n    };\r\n    // Takes data that's been encoded in a JSON-friendly form and returns a form\r\n    // with richer datatypes, such as Dates, etc.\r\n    Serializer.prototype.decode = function (json) {\r\n        var _this = this;\r\n        if (json === null) {\r\n            return json;\r\n        }\r\n        if (json['@type']) {\r\n            switch (json['@type']) {\r\n                case LONG_TYPE:\r\n                // Fall through and handle this the same as unsigned.\r\n                case UNSIGNED_LONG_TYPE: {\r\n                    // Technically, this could work return a valid number for malformed\r\n                    // data if there was a number followed by garbage. But it's just not\r\n                    // worth all the extra code to detect that case.\r\n                    var value = parseFloat(json.value);\r\n                    if (isNaN(value)) {\r\n                        throw new Error('Data cannot be decoded from JSON: ' + json);\r\n                    }\r\n                    return value;\r\n                }\r\n                default: {\r\n                    throw new Error('Data cannot be decoded from JSON: ' + json);\r\n                }\r\n            }\r\n        }\r\n        if (Array.isArray(json)) {\r\n            return json.map(function (x) { return _this.decode(x); });\r\n        }\r\n        if (typeof json === 'function' || typeof json === 'object') {\r\n            return mapValues(json, function (x) { return _this.decode(x); });\r\n        }\r\n        // Anything else is safe to return.\r\n        return json;\r\n    };\r\n    return Serializer;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a Promise that will be rejected after the given duration.\r\n * The error will be of type HttpsErrorImpl.\r\n *\r\n * @param millis Number of milliseconds to wait before rejecting.\r\n */\r\nfunction failAfter(millis) {\r\n    return new Promise(function (_, reject) {\r\n        setTimeout(function () {\r\n            reject(new HttpsErrorImpl('deadline-exceeded', 'deadline-exceeded'));\r\n        }, millis);\r\n    });\r\n}\r\n/**\r\n * The main class for the Firebase Functions SDK.\r\n */\r\nvar Service = /** @class */ (function () {\r\n    /**\r\n     * Creates a new Functions service for the given app and (optional) region.\r\n     * @param app_ The FirebaseApp to use.\r\n     * @param region_ The region to call functions in.\r\n     */\r\n    function Service(app_, region_) {\r\n        var _this = this;\r\n        if (region_ === void 0) { region_ = 'us-central1'; }\r\n        this.app_ = app_;\r\n        this.region_ = region_;\r\n        this.serializer = new Serializer();\r\n        this.emulatorOrigin = null;\r\n        this.INTERNAL = {\r\n            delete: function () {\r\n                return _this.deleteService();\r\n            }\r\n        };\r\n        this.contextProvider = new ContextProvider(app_);\r\n        // Cancels all ongoing requests when resolved.\r\n        this.cancelAllRequests = new Promise(function (resolve) {\r\n            _this.deleteService = function () {\r\n                return resolve();\r\n            };\r\n        });\r\n    }\r\n    Object.defineProperty(Service.prototype, \"app\", {\r\n        get: function () {\r\n            return this.app_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Returns the URL for a callable with the given name.\r\n     * @param name The name of the callable.\r\n     */\r\n    Service.prototype._url = function (name) {\r\n        var projectId = this.app_.options.projectId;\r\n        var region = this.region_;\r\n        if (this.emulatorOrigin !== null) {\r\n            var origin_1 = this.emulatorOrigin;\r\n            return origin_1 + \"/\" + projectId + \"/\" + region + \"/\" + name;\r\n        }\r\n        return \"https://\" + region + \"-\" + projectId + \".cloudfunctions.net/\" + name;\r\n    };\r\n    /**\r\n     * Changes this instance to point to a Cloud Functions emulator running\r\n     * locally. See https://firebase.google.com/docs/functions/local-emulator\r\n     *\r\n     * @param origin The origin of the local emulator, such as\r\n     * \"http://localhost:5005\".\r\n     */\r\n    Service.prototype.useFunctionsEmulator = function (origin) {\r\n        this.emulatorOrigin = origin;\r\n    };\r\n    /**\r\n     * Returns a reference to the callable https trigger with the given name.\r\n     * @param name The name of the trigger.\r\n     */\r\n    Service.prototype.httpsCallable = function (name, options) {\r\n        var _this = this;\r\n        var callable = function (data) {\r\n            return _this.call(name, data, options || {});\r\n        };\r\n        return callable;\r\n    };\r\n    /**\r\n     * Does an HTTP POST and returns the completed response.\r\n     * @param url The url to post to.\r\n     * @param body The JSON body of the post.\r\n     * @param headers The HTTP headers to include in the request.\r\n     * @return A Promise that will succeed when the request finishes.\r\n     */\r\n    Service.prototype.postJSON = function (url, body, headers) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var response, e_1, json, e_2;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        headers.append('Content-Type', 'application/json');\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, fetch(url, {\r\n                                method: 'POST',\r\n                                body: JSON.stringify(body),\r\n                                headers: headers\r\n                            })];\r\n                    case 2:\r\n                        response = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        // This could be an unhandled error on the backend, or it could be a\r\n                        // network error. There's no way to know, since an unhandled error on the\r\n                        // backend will fail to set the proper CORS header, and thus will be\r\n                        // treated as a network error by fetch.\r\n                        return [2 /*return*/, {\r\n                                status: 0,\r\n                                json: null\r\n                            }];\r\n                    case 4:\r\n                        json = null;\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 6:\r\n                        json = _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 7:\r\n                        e_2 = _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 8: return [2 /*return*/, {\r\n                            status: response.status,\r\n                            json: json\r\n                        }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Calls a callable function asynchronously and returns the result.\r\n     * @param name The name of the callable trigger.\r\n     * @param data The data to pass as params to the function.s\r\n     */\r\n    Service.prototype.call = function (name, data, options) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var url, body, headers, context, timeout, response, error, responseData, decodedData;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        url = this._url(name);\r\n                        // Encode any special types, such as dates, in the input data.\r\n                        data = this.serializer.encode(data);\r\n                        body = { data: data };\r\n                        headers = new Headers();\r\n                        return [4 /*yield*/, this.contextProvider.getContext()];\r\n                    case 1:\r\n                        context = _a.sent();\r\n                        if (context.authToken) {\r\n                            headers.append('Authorization', 'Bearer ' + context.authToken);\r\n                        }\r\n                        if (context.instanceIdToken) {\r\n                            headers.append('Firebase-Instance-ID-Token', context.instanceIdToken);\r\n                        }\r\n                        timeout = options.timeout || 70000;\r\n                        return [4 /*yield*/, Promise.race([\r\n                                this.postJSON(url, body, headers),\r\n                                failAfter(timeout),\r\n                                this.cancelAllRequests\r\n                            ])];\r\n                    case 2:\r\n                        response = _a.sent();\r\n                        // If service was deleted, interrupted response throws an error.\r\n                        if (!response) {\r\n                            throw new HttpsErrorImpl('cancelled', 'Firebase Functions instance was deleted.');\r\n                        }\r\n                        error = _errorForResponse(response.status, response.json, this.serializer);\r\n                        if (error) {\r\n                            throw error;\r\n                        }\r\n                        if (!response.json) {\r\n                            throw new HttpsErrorImpl('internal', 'Response is not valid JSON object.');\r\n                        }\r\n                        responseData = response.json.data;\r\n                        // TODO(klimt): For right now, allow \"result\" instead of \"data\", for\r\n                        // backwards compatibility.\r\n                        if (typeof responseData === 'undefined') {\r\n                            responseData = response.json.result;\r\n                        }\r\n                        if (typeof responseData === 'undefined') {\r\n                            // Consider the response malformed.\r\n                            throw new HttpsErrorImpl('internal', 'Response is missing data field.');\r\n                        }\r\n                        decodedData = this.serializer.decode(responseData);\r\n                        return [2 /*return*/, { data: decodedData }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Service;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Type constant for Firebase Functions.\r\n */\r\nvar FUNCTIONS_TYPE = 'functions';\r\nfunction factory(app, unused, region) {\r\n    return new Service(app, region);\r\n}\r\nfunction registerFunctions(instance) {\r\n    var namespaceExports = {\r\n        // no-inline\r\n        Functions: Service\r\n    };\r\n    instance.INTERNAL.registerService(FUNCTIONS_TYPE, factory, namespaceExports, \r\n    // We don't need to wait on any AppHooks.\r\n    undefined, \r\n    // Allow multiple functions instances per app.\r\n    true);\r\n}\r\nregisterFunctions(firebase);\n\nexports.registerFunctions = registerFunctions;\n//# sourceMappingURL=index.cjs.js.map\n","import firebase from '@firebase/app';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nfunction __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nfunction __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nfunction __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nfunction __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nfunction __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nfunction __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nfunction __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nfunction __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nfunction __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nfunction __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nfunction __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nfunction __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n}\r\nfunction __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nfunction __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\n\nvar tslib_1 = /*#__PURE__*/Object.freeze({\n    __extends: __extends,\n    get __assign () { return __assign; },\n    __rest: __rest,\n    __decorate: __decorate,\n    __param: __param,\n    __metadata: __metadata,\n    __awaiter: __awaiter,\n    __generator: __generator,\n    __exportStar: __exportStar,\n    __values: __values,\n    __read: __read,\n    __spread: __spread,\n    __await: __await,\n    __asyncGenerator: __asyncGenerator,\n    __asyncDelegator: __asyncDelegator,\n    __asyncValues: __asyncValues,\n    __makeTemplateObject: __makeTemplateObject,\n    __importStar: __importStar,\n    __importDefault: __importDefault\n});\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = 'w:0.1.0'; // Will be replaced by Rollup\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration values.',\r\n    _a[\"create-installation-failed\" /* CREATE_INSTALLATION_FAILED */] = 'Could not register Firebase Installation.',\r\n    _a[\"generate-token-failed\" /* GENERATE_TOKEN_FAILED */] = 'Could not generate Auth Token.',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    if (!app || !app.options) {\r\n        throw ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */);\r\n    }\r\n    var appName = app.name;\r\n    var _a = app.options, projectId = _a.projectId, apiKey = _a.apiKey, appId = _a.appId;\r\n    if (!appName || !projectId || !apiKey || !appId) {\r\n        throw ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */);\r\n    }\r\n    return { appName: appName, projectId: projectId, apiKey: apiKey, appId: appId };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallation(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, fetch(endpoint, request)];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: throw getErrorFromResponse('Create Installation', response);\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(buffer) {\r\n    var array = buffer instanceof Uint8Array ? buffer : new Uint8Array(buffer);\r\n    var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Generates a new FID using random values from Web Crypto API. */\r\nfunction generateFid() {\r\n    // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n    // bytes. our implementation generates a 17 byte array instead.\r\n    var fidByteArray = new Uint8Array(17);\r\n    crypto.getRandomValues(fidByteArray);\r\n    // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n    fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n    return encode(fidByteArray);\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n    // We don't use 'break' in this switch statement, the fall-through\r\n    // behavior is what we want, because if there are multiple versions between\r\n    // the old version and the current version, we want ALL the migrations\r\n    // that correspond to those versions to run, not only the last one.\r\n    switch (upgradeDB.oldVersion) {\r\n        case 0:\r\n            upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n    }\r\n});\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, dbPromise];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    tx.objectStore(OBJECT_STORE_NAME).put(value, key);\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, dbPromise];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    tx.objectStore(OBJECT_STORE_NAME).delete(key);\r\n                    return [2 /*return*/, tx.complete];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, dbPromise];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (newValue === oldValue) {\r\n                        return [2 /*return*/, newValue];\r\n                    }\r\n                    if (newValue === undefined) {\r\n                        store.delete(key);\r\n                    }\r\n                    else {\r\n                        store.put(newValue, key);\r\n                    }\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    _a = {};\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            var installationEntry = updateOrCreateFid(oldEntry);\r\n                            var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                            registrationPromise = entryWithPromise.registrationPromise;\r\n                            return entryWithPromise.installationEntry;\r\n                        })];\r\n                case 1: return [2 /*return*/, (_a.installationEntry = _b.sent(),\r\n                        _a.registrationPromise = registrationPromise,\r\n                        _a)];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction updateOrCreateFid(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the registration\r\n * and return an InProgressInstallationEntry.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, createInstallation(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [4 /*yield*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 8];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 6:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (entry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                        throw ERROR_FACTORY.create(\"create-installation-failed\" /* CREATE_INSTALLATION_FAILED */);\r\n                    }\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        if (hasInstallationRequestTimedOut(oldEntry)) {\r\n            return {\r\n                fid: oldEntry.fid,\r\n                registrationStatus: 0 /* NOT_STARTED */\r\n            };\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(app) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        // Suppress registration errors as they are not a problem for getId.\r\n                        registrationPromise.catch(function () { });\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthToken(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, completedAuthToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, fetch(endpoint, request)];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _a.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: throw getErrorFromResponse('Generate Auth Token', response);\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(app) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, completeInstallationRegistration(appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    // At this point we either have a Registered Installation in the DB, or we've\r\n                    // already thrown an error.\r\n                    return [2 /*return*/, fetchAuthToken(appConfig)];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    if (installationEntry.registrationStatus !== 2 /* COMPLETED */) {\r\n                        // Installation ID can't be registered.\r\n                        throw ERROR_FACTORY.create(\"create-installation-failed\" /* CREATE_INSTALLATION_FAILED */);\r\n                    }\r\n                    _b.label = 4;\r\n                case 4: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction fetchAuthToken(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(appConfig);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(appConfig, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n */\r\nfunction waitUntilAuthTokenRequest(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        throw ERROR_FACTORY.create(\"generate-token-failed\" /* GENERATE_TOKEN_FAILED */);\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return __assign({}, oldEntry, { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthToken(appConfig, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = __assign({}, installationEntry, { authToken: authToken });\r\n                    return [4 /*yield*/, set(appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = __assign({}, installationEntry, { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return __assign({}, oldEntry, { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, fetch(endpoint, request)];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!response.ok) {\r\n                        throw getErrorFromResponse('Delete Installation', response);\r\n                    }\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation$1(app) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry &&\r\n                                oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallation(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    var factoryMethod = function (app) {\r\n        // Throws if app isn't configured properly.\r\n        extractAppConfig(app);\r\n        return {\r\n            app: app,\r\n            getId: function () { return getId(app); },\r\n            getToken: function () { return getToken(app); },\r\n            delete: function () { return deleteInstallation$1(app); }\r\n        };\r\n    };\r\n    instance.INTERNAL.registerService(installationsName, factoryMethod);\r\n}\r\nregisterInstallations(firebase);\n\nexport { registerInstallations };\n//# sourceMappingURL=index.esm.js.map\n","/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A container for all of the Logger instances\r\n */\r\nvar instances = [];\r\n/**\r\n * The JS SDK supports 5 log levels and also allows a user the ability to\r\n * silence the logs altogether.\r\n *\r\n * The order is a follows:\r\n * DEBUG < VERBOSE < INFO < WARN < ERROR\r\n *\r\n * All of the log types above the current log level will be captured (i.e. if\r\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\r\n * `VERBOSE` logs will not)\r\n */\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\r\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\r\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\r\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\r\n    LogLevel[LogLevel[\"ERROR\"] = 4] = \"ERROR\";\r\n    LogLevel[LogLevel[\"SILENT\"] = 5] = \"SILENT\";\r\n})(LogLevel || (LogLevel = {}));\r\n/**\r\n * The default log level\r\n */\r\nvar defaultLogLevel = LogLevel.INFO;\r\n/**\r\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\r\n * messages on to their corresponding console counterparts (if the log method\r\n * is supported by the current log level)\r\n */\r\nvar defaultLogHandler = function (instance, logType) {\r\n    var args = [];\r\n    for (var _i = 2; _i < arguments.length; _i++) {\r\n        args[_i - 2] = arguments[_i];\r\n    }\r\n    if (logType < instance.logLevel)\r\n        return;\r\n    var now = new Date().toISOString();\r\n    switch (logType) {\r\n        /**\r\n         * By default, `console.debug` is not displayed in the developer console (in\r\n         * chrome). To avoid forcing users to have to opt-in to these logs twice\r\n         * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\r\n         * logs to the `console.log` function.\r\n         */\r\n        case LogLevel.DEBUG:\r\n            console.log.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.VERBOSE:\r\n            console.log.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.INFO:\r\n            console.info.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.WARN:\r\n            console.warn.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.ERROR:\r\n            console.error.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        default:\r\n            throw new Error(\"Attempted to log a message with an invalid logType (value: \" + logType + \")\");\r\n    }\r\n};\r\nvar Logger = /** @class */ (function () {\r\n    /**\r\n     * Gives you an instance of a Logger to capture messages according to\r\n     * Firebase's logging scheme.\r\n     *\r\n     * @param name The name that the logs will be associated with\r\n     */\r\n    function Logger(name) {\r\n        this.name = name;\r\n        /**\r\n         * The log level of the given Logger instance.\r\n         */\r\n        this._logLevel = defaultLogLevel;\r\n        /**\r\n         * The log handler for the Logger instance.\r\n         */\r\n        this._logHandler = defaultLogHandler;\r\n        /**\r\n         * Capture the current instance for later use\r\n         */\r\n        instances.push(this);\r\n    }\r\n    Object.defineProperty(Logger.prototype, \"logLevel\", {\r\n        get: function () {\r\n            return this._logLevel;\r\n        },\r\n        set: function (val) {\r\n            if (!(val in LogLevel)) {\r\n                throw new TypeError('Invalid value assigned to `logLevel`');\r\n            }\r\n            this._logLevel = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Logger.prototype, \"logHandler\", {\r\n        get: function () {\r\n            return this._logHandler;\r\n        },\r\n        set: function (val) {\r\n            if (typeof val !== 'function') {\r\n                throw new TypeError('Value assigned to `logHandler` must be a function');\r\n            }\r\n            this._logHandler = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * The functions below are all based on the `console` interface\r\n     */\r\n    Logger.prototype.debug = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.DEBUG].concat(args));\r\n    };\r\n    Logger.prototype.log = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.VERBOSE].concat(args));\r\n    };\r\n    Logger.prototype.info = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.INFO].concat(args));\r\n    };\r\n    Logger.prototype.warn = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.WARN].concat(args));\r\n    };\r\n    Logger.prototype.error = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.ERROR].concat(args));\r\n    };\r\n    return Logger;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction setLogLevel(level) {\r\n    instances.forEach(function (inst) {\r\n        inst.logLevel = level;\r\n    });\r\n}\n\nexport { LogLevel, Logger, setLogLevel };\n//# sourceMappingURL=index.esm.js.map\n"],"sourceRoot":""}